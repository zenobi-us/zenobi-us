#!/usr/bin/env bash

set -e

#USAGE flag "-t --title <title>" help="The title of the post"

. ".mise/helpers.sh"

create_new_post() {

    local title
    local date

    title="${1}"
    date=$(date +"%Y-%m-%d")

    template_context="{\"Date\":\"$(date +"%Y-%m-%d")\",\"Title\":\"${title}\"}"
    file_template='"content/posts/\(.Date)-\(.Title | sub("\\W+"; "-"; "g") | gsub("-$";"") | ascii_downcase).md"'
    filepath=$(template "$file_template" "${template_context}")

    dedent """
        ---
        date: ${date}
        title: ${title}
        draft: true
        filepath: ${filepath}
        ---
    """ >"${filepath}"

}

echo "Creating post with title: ${usage_title}"

title="$(arg_or_prompt "Enter the title of the post" "${usage_title}")"
create_new_post "$title"
